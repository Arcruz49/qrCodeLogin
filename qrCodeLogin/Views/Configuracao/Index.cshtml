@model qrCodeLogin.Models.CadUsuario

<section style="background-color: #f8f9fa; border-radius: 30px">
    <div class="container py-5">
       

        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <img id="profileImage" src="@(Model.ProfileImage != null ? $"data:image/png;base64,{Convert.ToBase64String(Model.ProfileImage)}" : "/images/user icon.jpg")"
                             alt="avatar" class="rounded-circle img-fluid" style="width: 150px;">


                        <h5 class="my-3">@Model.NmUsuario</h5>
                        <p class="text-muted mb-1">@ViewBag.nmPerfil</p>
                        <p class="text-muted mb-4">@Model.Ocupacao</p>
                        <div class="d-flex justify-content-center mb-2">
                            <button type="button" id="editBtn" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary">Edit</button>
                            <button type="button" id="saveBtn" data-mdb-button-init data-mdb-ripple-init class="btn btn-success d-none">Save</button>
                            <button type="button" id="cancelBtn" data-mdb-button-init data-mdb-ripple-init class="btn btn-danger d-none">Cancel</button>
                        </div>
                        <input type="file" id="imageUpload" class="form-control d-none" accept="image/*">

                    </div>
                </div>
                <div class="card mb-4 mb-lg-0">
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush rounded-3">
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <i class="fas fa-globe fa-lg text-warning"></i>
                                <input type="url" name="Site" class="links" value="@(Model.Site ?? "")" disabled>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <i class="fab fa-github fa-lg text-body"></i>
                                <input type="url" name="Github" class="links" value="@(Model.Github ?? "")" disabled>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <i class="fab fa-twitter fa-lg" style="color: #55acee;"></i>
                                <input type="url" name="Twitter" class="links" value="@(Model.Twitter ?? "")" disabled>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <i class="fab fa-instagram fa-lg" style="color: #ac2bac;"></i>
                                <input type="url" name="Instagram" class="links" value="@(Model.Instagram ?? "")" disabled>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <i class="fab fa-facebook-f fa-lg" style="color: #3b5998;"></i>
                                <input type="url" name="Facebook" class="links" value="@(Model.Facebook ?? "")" disabled>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Name</p>
                            </div>
                            <div class="col-sm-9">
                                <p name="NmUsuario" class="text-muted mb-0">@Model.NmUsuario</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Email</p>
                            </div>
                            <div class="col-sm-9">
                                <p name="Email" class="text-muted mb-0">@Model.Email</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Phone</p>
                            </div>
                            <div class="col-sm-9">
                                <input name="Telefone1" type="text" class="telefone" value="@(Model.Telefone1 ?? "")" disabled>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Mobile</p>
                            </div>
                            <div class="col-sm-9">
                                <input name="Telefone2" type="text" class="telefone" value="@(Model.Telefone2 ?? "")" disabled>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Occupation</p>
                            </div>
                            <div class="col-sm-9">
                                <input name="Ocupacao" type="text" class="links" value="@(Model.Ocupacao ?? "")" disabled>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4 mb-md-0">
                            <div class="card-body">
                                <p class="mb-4">
                                    <span class="text-primary font-italic me-1">assigment</span> Project Status
                                </p>
                                <p class="mb-1" style="font-size: .77rem;">Web Design</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-4 mb-1" style="font-size: .77rem;">One Page</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-4 mb-1" style="font-size: .77rem;">Mobile Template</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-4 mb-1" style="font-size: .77rem;">Backend API</p>
                                <div class="progress rounded mb-2" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-4 mb-md-0">
                            <div class="card-body">
                                <p class="mb-4">
                                    <span class="text-primary font-italic me-1">assigment</span> Project Status
                                </p>
                                <p class="mb-1" style="font-size: .77rem;">Web Design</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
                                <div class="progress rounded" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
                                         aria-valuemin="0" aria-valuemax="100"></div>

<style>
    .links {
        background-color: transparent !important;
        border: none;
        width: 100%; 
        margin-left: 10px;
    }

    .btn{
        margin: 5px;
    }

    .telefone{
        background-color: transparent !important;
        border: none;
        width: 100%;
        margin-left: 10px;
    }

</style>

<script>
    $(document).ready(function () {
        $('.telefone').mask('(00) 00000-0000');
    });

    $("#editBtn").on("click", function () {
        $('.links').prop('disabled', false);
        $('.telefone').prop('disabled', false);
        $('#imageUpload').removeClass('d-none');
        $('#editBtn').hide();
        $("#saveBtn").removeClass("d-none");
        $("#cancelBtn").removeClass("d-none");
    });

    $("#cancelBtn").on("click", function () {
        Swal.fire({
            title: "Are you sure?",
            text: "Unsaved changes will be lost",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Confirm"
        }).then((result) => {
            if (result.isConfirmed) {
                location.reload();
            }
        });
    });

    $("#imageUpload").on("change", function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                $("#profileImage").attr("src", e.target.result);
            };
            reader.readAsDataURL(file);
        }
    });


    $("#saveBtn").on("click", function () {
        const formData = new FormData();
        formData.append("CdUsuario", @Model.CdUsuario);
        formData.append("NmUsuario", '@Model.NmUsuario');
        formData.append("Email", '@Model.Email');
        formData.append("Telefone1", $('.telefone').eq(0).val());
        formData.append("Telefone2", $('.telefone').eq(1).val());
        formData.append("Site", $('.links').eq(0).val());
        formData.append("Github", $('.links').eq(1).val());
        formData.append("Twitter", $('.links').eq(2).val());
        formData.append("Instagram", $('.links').eq(3).val());
        formData.append("Facebook", $('.links').eq(4).val());
        formData.append("Ocupacao", $('.links').eq(5).val());

        const imageFile = $("#imageUpload")[0].files[0];
        if (imageFile) {
            formData.append("ProfileImage", imageFile);
        }

        $.ajax({
            url: '/Configuracao/AlteraDadosUsuario',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.success) {
                    location.reload();
                } else {
                    Swal.fire({
                        title: "Error",
                        text: response.message,
                        icon: "warning",
                        confirmButtonColor: "#3085d6",
                        confirmButtonText: "ok"
                    });
                }
            },
            error: function () {
                Swal.fire("Erro!", "Ocorreu um problema ao salvar as informações.", "error");
            }
        });
    });
</script>
